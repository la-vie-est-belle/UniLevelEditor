window.__require=function e(t,i,o){function n(d,r){if(!i[d]){if(!t[d]){var a=d.split("/");if(a=a[a.length-1],!t[a]){var c="function"==typeof __require&&__require;if(!r&&c)return c(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+d+"'")}d=a}var h=i[d]={exports:{}};t[d][0].call(h.exports,function(e){return n(t[d][1][e]||e)},h,h.exports,e,t,i,o)}return i[d].exports}for(var s="function"==typeof __require&&__require,d=0;d<o.length;d++)n(o[d]);return n}({Demo:[function(e,t,i){"use strict";cc._RF.push(t,"7012aDSePlJYIJr2maAAI2a","Demo");var o,n=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__decorate||function(e,t,i,o){var n,s=arguments.length,d=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(d=(s<3?n(d):s>3?n(t,i,d):n(t,i))||d);return s>3&&d&&Object.defineProperty(t,i,d),d};Object.defineProperty(i,"__esModule",{value:!0});var d=cc._decorator,r=d.ccclass,a=d.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.board=null,t.itemPrefab=null,t.levelJsonAsset=null,t.levelJsonData=null,t}return n(t,e),t.prototype.start=function(){this.levelJsonData=this.levelJsonAsset.json,this.initBoard(),this.addItems()},t.prototype.initBoard=function(){this.board.width=this.levelJsonData.hNum*this.levelJsonData.itemWidth,this.board.height=this.levelJsonData.vNum*this.levelJsonData.itemHeight},t.prototype.addItems=function(){for(var e=this.levelJsonData.items,t=0;t<e.length;t++){var i=e[t],o=this.spawnItem(i.name,i.x,i.y,i.isBlocked);this.board.addChild(o)}},t.prototype.spawnItem=function(e,t,i,o){var n=cc.instantiate(this.itemPrefab);n.x=t,n.y=i,o&&(n.color=new cc.Color(100,100,100));var s=this;return cc.resources.load("demo/"+e,cc.SpriteFrame,function(e,t){n.getComponent(cc.Sprite).spriteFrame=t,n.width=s.levelJsonData.itemWidth,n.height=s.levelJsonData.itemHeight}),n},s([a(cc.Node)],t.prototype,"board",void 0),s([a(cc.Prefab)],t.prototype,"itemPrefab",void 0),s([a(cc.JsonAsset)],t.prototype,"levelJsonAsset",void 0),s([r],t)}(cc.Component);i.default=c,cc._RF.pop()},{}],GridBoard:[function(e,t,i){"use strict";cc._RF.push(t,"9820b/oGExM45R8/VlVPumJ","GridBoard");var o,n=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__decorate||function(e,t,i,o){var n,s=arguments.length,d=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(d=(s<3?n(d):s>3?n(t,i,d):n(t,i))||d);return s>3&&d&&Object.defineProperty(t,i,d),d};Object.defineProperty(i,"__esModule",{value:!0});var d=cc._decorator,r=d.ccclass,a=d.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.picScrollView=null,t.gridBoardCover=null,t.indicatorCover=null,t.itemIndicator=null,t.gridItemPrefab=null,t.gridLayoutComp=null,t.levelEditorComp=null,t.picScrollViewComp=null,t.isPutOrDelActionAvailable=!0,t}return n(t,e),t.prototype.start=function(){if(this.initComponents(),this.initGridBoard(),this.addEvents(),this.levelEditorComp.editorData){var e=this.levelEditorComp.editorData.levelData;this.restorePicItems(e)}},t.prototype.initComponents=function(){this.gridLayoutComp=this.node.getComponent(cc.Layout),this.levelEditorComp=cc.find("Canvas").getComponent("LevelEditor"),this.picScrollViewComp=this.picScrollView.getComponent("PicScrollView")},t.prototype.initGridBoard=function(){this.node.removeAllChildren(),this.gridLayoutComp.cellSize=new cc.Size(this.levelEditorComp.gridItemWidth,this.levelEditorComp.gridItemHeight),this.node.width=this.levelEditorComp.hGridItemNum*this.levelEditorComp.gridItemWidth,this.node.height=this.levelEditorComp.vGridItemNum*this.levelEditorComp.gridItemHeight,this.gridBoardCover.width=this.node.width,this.gridBoardCover.height=this.node.height,this.indicatorCover.width=this.node.width,this.indicatorCover.height=this.node.height;for(var e=this.levelEditorComp.hGridItemNum*this.levelEditorComp.vGridItemNum,t=0;t<e;t++){var i=this.spawnGridItem();this.node.addChild(i)}},t.prototype.restorePicItems=function(e){for(var t=e.items,i=function(i){var n=cc.instantiate(o.picScrollViewComp.picItemPrefab),s=t[i];n.x=s.x,n.y=s.y,n.name=s.name,s.isBlocked&&(n.color=new cc.Color(100,100,100)),o.gridBoardCover.addChild(n),cc.resources.load("pic/"+s.name,cc.SpriteFrame,function(t,i){n.getComponent(cc.Sprite).spriteFrame=i,n.width=e.itemWidth,n.height=e.itemHeight})},o=this,n=0;n<t.length;n++)i(n);this.levelEditorComp.updatePicNum()},t.prototype.addEvents=function(){this.node.on(cc.Node.EventType.MOUSE_DOWN,this.onMouseDown,this),this.node.on(cc.Node.EventType.MOUSE_MOVE,this.onMouseMove,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this.onMouseLeave,this)},t.prototype.spawnGridItem=function(){var e=cc.instantiate(this.gridItemPrefab);return e.width=this.levelEditorComp.gridItemWidth,e.height=this.levelEditorComp.gridItemHeight,e},t.prototype.isTop=function(e){for(var t=0;t<this.gridBoardCover.children.length;t++){var i=this.gridBoardCover.children[t];if(!(i.getSiblingIndex()<e.getSiblingIndex()||e==i)){var o=new cc.Rect;if(e.getBoundingBox().intersection(o,i.getBoundingBox()),o.width>0&&o.height>0)return!1}}return!0},t.prototype.getIntersectedPicItems=function(e){for(var t=[],i=0;i<this.gridBoardCover.children.length;i++){var o=this.gridBoardCover.children[i];if(e!=o){var n=new cc.Rect;e.getBoundingBox().intersection(n,o.getBoundingBox()),n.width>0&&n.height>0&&t.push(o)}}return t},t.prototype.onMouseDown=function(e){if(this.isPutOrDelActionAvailable){var t=this.node.convertToNodeSpaceAR(e.getLocation());"PUT"==this.levelEditorComp.gridBoardAction?this.addNewPicItemToGridBoardCover(t):this.deletePicItemFromGridBoardCover(t)}},t.prototype.addNewPicItemToGridBoardCover=function(e){for(var t=0;t<this.node.children.length;t++){var i=this.node.children[t];if(i.getBoundingBox().contains(e)){if(!this.picScrollViewComp.selectedPicItem){this.levelEditorComp.showTip("\u8bf7\u9009\u62e9\u8981\u653e\u7f6e\u7684\u56fe\u7247");break}var o=cc.instantiate(this.picScrollViewComp.selectedPicItem);o.width=i.width,o.height=i.height,o.setScale(new cc.Vec2(1,1)),o.setPosition(i.position.add(new cc.Vec3(this.levelEditorComp.offsetX,this.levelEditorComp.offsetY,0)));for(var n=0;n<this.gridBoardCover.children.length;n++){var s=new cc.Rect,d=this.gridBoardCover.children[n];d.getBoundingBox().intersection(s,o.getBoundingBox()),s.width>0&&s.height>0&&(d.color=new cc.Color(100,100,100))}this.gridBoardCover.addChild(o),this.levelEditorComp.updateLocalStorage(),this.levelEditorComp.updatePicNum();break}}},t.prototype.deletePicItemFromGridBoardCover=function(e){if(0!=this.gridBoardCover.children.length)for(var t=0;t<this.gridBoardCover.children.length;t++){var i=this.gridBoardCover.children[t];if(i.getBoundingBox().contains(e)&&"646464"!=i.color.toHEX()){this.itemIndicator.active=!1;var o=this.getIntersectedPicItems(i);i.removeFromParent();for(var n=0;n<o.length;n++){var s=o[n];this.isTop(s)&&(s.color=new cc.Color(255,255,255),this.itemIndicator.active=!0,this.itemIndicator.scale=s.scale,this.itemIndicator.width=s.width,this.itemIndicator.height=s.height,this.itemIndicator.position=s.position)}this.levelEditorComp.updateLocalStorage(),this.levelEditorComp.updatePicNum();break}}else this.levelEditorComp.showTip("\u6ca1\u6709\u53ef\u5220\u9664\u7684\u56fe\u7247")},t.prototype.onMouseMove=function(e){var t=this.node.convertToNodeSpaceAR(e.getLocation());if("PUT"==this.levelEditorComp.gridBoardAction)for(var i=0;i<this.node.children.length;i++){var o=this.node.children[i];if(o.getBoundingBox().contains(t)){this.itemIndicator.active=!0,this.itemIndicator.scale=o.scale,this.itemIndicator.width=o.width,this.itemIndicator.height=o.height,this.itemIndicator.position=o.position.add(new cc.Vec3(this.levelEditorComp.offsetX,this.levelEditorComp.offsetY,0));break}}else for(i=0;i<this.gridBoardCover.children.length;i++){var n=this.gridBoardCover.children[i];if(n.getBoundingBox().contains(t)&&"646464"!=n.color.toHEX()){this.itemIndicator.active=!0,this.itemIndicator.scale=n.scale,this.itemIndicator.width=n.width,this.itemIndicator.height=n.height,this.itemIndicator.position=n.position;break}}},t.prototype.onMouseLeave=function(){for(var e=0;e<this.node.children.length;e++)this.itemIndicator.active=!1},s([a(cc.Node)],t.prototype,"picScrollView",void 0),s([a(cc.Node)],t.prototype,"gridBoardCover",void 0),s([a(cc.Node)],t.prototype,"indicatorCover",void 0),s([a(cc.Node)],t.prototype,"itemIndicator",void 0),s([a(cc.Prefab)],t.prototype,"gridItemPrefab",void 0),s([r],t)}(cc.Component);i.default=c,cc._RF.pop()},{}],LevelEditor:[function(e,t,i){"use strict";cc._RF.push(t,"f1d1dqlUOdEZZn5H+4o16At","LevelEditor");var o,n=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__decorate||function(e,t,i,o){var n,s=arguments.length,d=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(d=(s<3?n(d):s>3?n(t,i,d):n(t,i))||d);return s>3&&d&&Object.defineProperty(t,i,d),d};Object.defineProperty(i,"__esModule",{value:!0});var d=cc._decorator,r=d.ccclass,a=d.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gridBoard=null,t.gridBoardCover=null,t.indicatorCover=null,t.picScrollView=null,t.picScrollViewContent=null,t.hGridItemNumEditBox=null,t.vGridItemNumEditBox=null,t.gridItemWidthEditBox=null,t.gridItemHeightEditBox=null,t.offsetXEditBox=null,t.offsetYEditBox=null,t.noMovingToggle=null,t.noScalingToggle=null,t.putToggle=null,t.delToggle=null,t.messageBoard=null,t.choiceBoard=null,t.creationBoard=null,t.portBoard=null,t.eyeOpenButton=null,t.eyeCloseButton=null,t.menuBoard=null,t.utilsBoard=null,t.numScrollView=null,t.jsonBoard=null,t.jsonBoardLabel=null,t.offsetX=0,t.offsetY=0,t.hGridItemNum=10,t.vGridItemNum=10,t.gridItemWidth=30,t.gridItemHeight=30,t.gridBoardAction="PUT",t.isGridBoardMovable=!0,t.isGridBoardScalable=!0,t.editorData=null,t.gridBoardComp=null,t.picScrollViewComp=null,t.choiceSituation=null,t.isRestoringLocalStorage=!1,t}return n(t,e),t.prototype.start=function(){var e=this;if(cc.debug.setDisplayStats(!1),this.addEvents(),this.initComponents(),this.restoreEditorFromLocalStorage(),!localStorage.getItem("isUserGuideShown")){var t=this.node.getComponent("UserGuide");t.setGuideTextPos("center"),t.showGuide(1,!0,function(){e.showAll(),localStorage.setItem("isUserGuideShown","1")})}},t.prototype.addEvents=function(){this.node.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},t.prototype.initComponents=function(){this.gridBoardComp=this.gridBoard.getComponent("GridBoard"),this.picScrollViewComp=this.picScrollView.getComponent("PicScrollView")},t.prototype.onHorizontalItemNumberChanged=function(e){var t=parseInt(e);this.hGridItemNum=t},t.prototype.onVerticalItemNumberChanged=function(e){var t=parseInt(e);this.vGridItemNum=t},t.prototype.onGridItemWidthChanged=function(e){var t=parseInt(e);this.gridItemWidth=t},t.prototype.onGridItemHeightChanged=function(e){var t=parseInt(e);this.gridItemHeight=t},t.prototype.onOffsetXChanged=function(e){var t=parseFloat(e.string);isNaN(t)?this.showTip("\u8bf7\u8f93\u5165\u4e00\u4e2a\u5408\u7406\u6570\u5b57"):(this.offsetX=t,this.updateLocalStorage())},t.prototype.onOffsetYChanged=function(e){var t=parseFloat(e.string);isNaN(t)?this.showTip("\u8bf7\u8f93\u5165\u4e00\u4e2a\u5408\u7406\u6570\u5b57"):(this.offsetY=t,this.updateLocalStorage())},t.prototype.onMouseWheel=function(e){if(this.isGridBoardScalable){var t=this.node.convertToNodeSpaceAR(e.getLocation());if(!this.picScrollView.getBoundingBox().contains(t)){var i=e.getScrollY();i>0?(this.gridBoard.scale+=.05,this.gridBoardCover.scale=this.gridBoard.scale,this.indicatorCover.scale=this.gridBoard.scale):i<0&&this.gridBoard.scale>=.2&&(this.gridBoard.scale-=.05,this.gridBoardCover.scale=this.gridBoard.scale,this.indicatorCover.scale=this.gridBoard.scale),this.updateLocalStorage()}}},t.prototype.onTouchMove=function(e){if(this.isGridBoardMovable){var t=e.getDelta();this.gridBoard.setPosition(this.gridBoard.position.add(new cc.Vec3(t.x,t.y,0))),this.gridBoardCover.position=this.gridBoard.position,this.indicatorCover.position=this.gridBoard.position,this.updateLocalStorage()}},t.prototype.onKeyDown=function(e){switch(e.keyCode){case cc.macro.KEY.a:this.offsetX-=1,this.offsetXEditBox.getComponent(cc.EditBox).string=this.offsetX.toString(),this.gridBoardComp.itemIndicator.setPosition(this.gridBoardComp.itemIndicator.position.add(new cc.Vec3(-1,0,0))),this.updateLocalStorage();break;case cc.macro.KEY.d:this.offsetX+=1,this.offsetXEditBox.getComponent(cc.EditBox).string=this.offsetX.toString(),this.gridBoardComp.itemIndicator.setPosition(this.gridBoardComp.itemIndicator.position.add(new cc.Vec3(1,0,0))),this.updateLocalStorage();break;case cc.macro.KEY.s:this.offsetY-=1,this.offsetYEditBox.getComponent(cc.EditBox).string=this.offsetY.toString(),this.gridBoardComp.itemIndicator.setPosition(this.gridBoardComp.itemIndicator.position.add(new cc.Vec3(0,-1,0))),this.updateLocalStorage();break;case cc.macro.KEY.w:this.offsetY+=1,this.offsetYEditBox.getComponent(cc.EditBox).string=this.offsetY.toString(),this.gridBoardComp.itemIndicator.setPosition(this.gridBoardComp.itemIndicator.position.add(new cc.Vec3(0,1,0))),this.updateLocalStorage()}},t.prototype.onResetPosButtonClicked=function(){this.gridBoard.setPosition(new cc.Vec2(0,0)),this.gridBoardCover.position=this.gridBoard.position,this.indicatorCover.position=this.gridBoard.position,this.updateLocalStorage()},t.prototype.onResetScaleButtonClicked=function(){this.gridBoard.setScale(new cc.Vec2(1,1)),this.gridBoardCover.scale=this.gridBoard.scale,this.indicatorCover.scale=this.gridBoard.scale,this.updateLocalStorage()},t.prototype.onClearAllButtonClicked=function(){this.gridBoardComp.isPutOrDelActionAvailable=!1,this.choiceBoard.active=!0,this.choiceBoard.children[0].getComponent(cc.Label).string="\u662f\u5426\u6e05\u9664\u5168\u90e8\u5185\u5bb9?",this.choiceSituation="CLEAR"},t.prototype.onChoiceYesButtonClicked=function(){"CLEAR"==this.choiceSituation?(this.gridBoardCover.removeAllChildren(),this.updateLocalStorage(),this.updatePicNum()):"CREATION"==this.choiceSituation&&(this.creationBoard.active=!1,this.gridBoardComp.isPutOrDelActionAvailable=!0,this.gridBoardCover.removeAllChildren(),this.updateLocalStorage(),this.updatePicNum(),this.gridBoardComp.initGridBoard()),this.choiceBoard.active=!1,this.gridBoardComp.isPutOrDelActionAvailable=!0},t.prototype.onChoiceNoButtonClicked=function(){this.choiceBoard.active=!1,this.gridBoardComp.isPutOrDelActionAvailable=!0},t.prototype.onNoMovingToggleChanged=function(e){e.isChecked?this.isGridBoardMovable=!1:this.isGridBoardMovable=!0,this.updateLocalStorage()},t.prototype.onNoScalingToggleChanged=function(e){e.isChecked?this.isGridBoardScalable=!1:this.isGridBoardScalable=!0,this.updateLocalStorage()},t.prototype.onImportButtonClicked=function(){var e=this,t=this,i=new FileReader;i.onload=function(i){try{var o=JSON.parse(i.target.result.toString());e.gridBoardCover.removeAllChildren(),e.hGridItemNum=o.hNum,e.vGridItemNum=o.vNum,e.hGridItemNumEditBox.getComponent(cc.EditBox).string=e.hGridItemNum.toString(),e.vGridItemNumEditBox.getComponent(cc.EditBox).string=e.vGridItemNum.toString(),e.gridItemWidth=o.itemWidth,e.gridItemHeight=o.itemHeight,e.gridItemWidthEditBox.getComponent(cc.EditBox).string=e.gridItemWidth.toString(),e.gridItemHeightEditBox.getComponent(cc.EditBox).string=e.gridItemHeight.toString(),e.gridBoardComp.initGridBoard(),t.gridBoardComp.restorePicItems(o),t.picScrollViewComp.restoreSelectedPicItem(),t.updateLocalStorage(),e.updatePicNum(),t.portBoard.active=!1,t.gridBoardComp.isPutOrDelActionAvailable=!0,t.showTip("\u5bfc\u5165\u6210\u529f!")}catch(n){t.showTip("JSON\u89e3\u6790\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5json\u683c\u5f0f")}},i.onerror=function(e){t.showTip("\u6587\u4ef6\u8bfb\u53d6\u9519\u8bef: "+e.target.error)};var o=document.createElement("input");o.setAttribute("type","file"),o.setAttribute("accept","application/json"),o.style.display="none",document.body.appendChild(o),o.onchange=function(){var e=o.files;if(e&&e.length>0){var t=e[0];i.readAsText(t)}},o.click(),document.body.removeChild(o)},t.prototype.onExportButtonClicked=function(){this.showTip("\u4f53\u9a8c\u7248\u5bfc\u51fa\u529f\u80fd\u65e0\u6cd5\u4f7f\u7528")},t.prototype.onPutOrDelToggleChanged=function(e){"Put Toggle"==e.target.name?this.gridBoardAction="PUT":this.gridBoardAction="DEL",this.updateLocalStorage()},t.prototype.onCreationBoardCreateButtonClicked=function(){isNaN(this.hGridItemNum)?this.showTip("\u6a2a\u5411\u6570\u91cf: \u8bf7\u8f93\u5165\u4e00\u4e2a\u5408\u7406\u6570\u5b57"):isNaN(this.vGridItemNum)?this.showTip("\u7eb5\u5411\u6570\u91cf: \u8bf7\u8f93\u5165\u4e00\u4e2a\u5408\u7406\u6570\u5b57"):isNaN(this.gridItemWidth)?this.showTip("\u65b9\u5757\u5bbd\u5ea6: \u8bf7\u8f93\u5165\u4e00\u4e2a\u5408\u7406\u6570\u5b57"):isNaN(this.gridItemHeight)?this.showTip("\u65b9\u5757\u9ad8\u5ea6: \u8bf7\u8f93\u5165\u4e00\u4e2a\u5408\u7406\u6570\u5b57"):this.gridBoardCover.children.length>0?(this.gridBoardComp.isPutOrDelActionAvailable=!1,this.choiceBoard.active=!0,this.choiceBoard.children[0].getComponent(cc.Label).string="\u65b0\u5efa\u753b\u5e03\u4f1a\u6e05\u9664\u5f53\u524d\u6240\u6709\u5185\u5bb9\uff0c\u662f\u5426\u7ee7\u7eed?",this.choiceSituation="CREATION"):(this.creationBoard.active=!1,this.gridBoardComp.isPutOrDelActionAvailable=!0,this.gridBoardCover.removeAllChildren(),this.updateLocalStorage(),this.updatePicNum(),this.gridBoardComp.initGridBoard())},t.prototype.onCreationBoardCancelButtonClicked=function(){this.creationBoard.active=!1,this.gridBoardComp.isPutOrDelActionAvailable=!0},t.prototype.onGridCreationButtonClicked=function(){this.choiceBoard.active=!1,this.portBoard.active=!1,this.jsonBoard.active=!1,this.creationBoard.active?(this.creationBoard.active=!1,this.gridBoardComp.isPutOrDelActionAvailable=!0):(this.creationBoard.active=!0,this.gridBoardComp.isPutOrDelActionAvailable=!1)},t.prototype.onPortButtonClicked=function(){this.choiceBoard.active=!1,this.creationBoard.active=!1,this.jsonBoard.active=!1,this.portBoard.active?(this.portBoard.active=!1,this.gridBoardComp.isPutOrDelActionAvailable=!0):(this.portBoard.active=!0,this.gridBoardComp.isPutOrDelActionAvailable=!1)},t.prototype.getLevelData=function(){for(var e={hNum:this.hGridItemNum,vNum:this.vGridItemNum,itemWidth:this.gridItemWidth,itemHeight:this.gridItemHeight,items:[]},t=0;t<this.gridBoardCover.children.length;t++){var i=this.gridBoardCover.children[t];e.items.push({name:i.name,x:i.position.x,y:i.position.y,isBlocked:"646464"==i.color.toHEX(),zIndex:i.getSiblingIndex()})}return e},t.prototype.restoreEditorFromLocalStorage=function(){if(this.editorData=localStorage.getItem("uni-level-editor"),this.editorData){this.isRestoringLocalStorage=!0,this.editorData=JSON.parse(this.editorData);var e=this.editorData.levelData;this.gridBoard.x=this.editorData.gridBoardX,this.gridBoard.y=this.editorData.gridBoardY,this.gridBoardCover.position=this.gridBoard.position,this.indicatorCover.position=this.gridBoard.position,this.gridBoard.scale=this.editorData.gridBoardScale,this.gridBoardCover.scale=this.gridBoard.scale,this.indicatorCover.scale=this.gridBoard.scale,this.gridBoardAction=this.editorData.gridBoardAction,"PUT"==this.gridBoardAction?(this.putToggle.getComponent(cc.Toggle).isChecked=!0,this.delToggle.getComponent(cc.Toggle).isChecked=!1):(this.putToggle.getComponent(cc.Toggle).isChecked=!1,this.delToggle.getComponent(cc.Toggle).isChecked=!0),this.isGridBoardMovable=this.editorData.isMovable,this.isGridBoardScalable=this.editorData.isScalable,this.isGridBoardMovable||(this.noMovingToggle.getComponent(cc.Toggle).isChecked=!0),this.isGridBoardScalable||(this.noScalingToggle.getComponent(cc.Toggle).isChecked=!0),this.offsetX=this.editorData.offsetX,this.offsetY=this.editorData.offsetY,this.offsetXEditBox.getComponent(cc.EditBox).string=this.offsetX.toString(),this.offsetYEditBox.getComponent(cc.EditBox).string=this.offsetY.toString(),this.numScrollView.active=this.editorData.isPicNumShown,this.hGridItemNum=e.hNum,this.vGridItemNum=e.vNum,this.hGridItemNumEditBox.getComponent(cc.EditBox).string=this.hGridItemNum.toString(),this.vGridItemNumEditBox.getComponent(cc.EditBox).string=this.vGridItemNum.toString(),this.gridItemWidth=e.itemWidth,this.gridItemHeight=e.itemHeight,this.gridItemWidthEditBox.getComponent(cc.EditBox).string=this.gridItemWidth.toString(),this.gridItemHeightEditBox.getComponent(cc.EditBox).string=this.gridItemHeight.toString(),this.isRestoringLocalStorage=!1}},t.prototype.updateLocalStorage=function(){var e;this.isRestoringLocalStorage||(this.editorData={gridBoardX:this.gridBoard.x,gridBoardY:this.gridBoard.y,gridBoardScale:this.gridBoard.scale,gridBoardAction:this.gridBoardAction,isMovable:this.isGridBoardMovable,isScalable:this.isGridBoardScalable,offsetX:this.offsetX,offsetY:this.offsetY,picItemName:null===(e=this.picScrollViewComp.selectedPicItem)||void 0===e?void 0:e.name,isPicNumShown:this.numScrollView.active,levelData:this.getLevelData()},localStorage.setItem("uni-level-editor",JSON.stringify(this.editorData)))},t.prototype.showTip=function(e,t){void 0===t&&(t=2),this.messageBoard.active=!0,this.messageBoard.children[0].getComponent(cc.Label).string=e,this.unschedule(this.hideTip),-1!=t&&this.scheduleOnce(this.hideTip,t)},t.prototype.hideTip=function(){this.messageBoard.active=!1},t.prototype.showAll=function(){this.eyeCloseButton.active=!1,this.gridBoard.active=!0,this.eyeOpenButton.active=!0,this.picScrollView.active=!0,this.utilsBoard.active=!0,this.menuBoard.active=!0,this.gridBoardComp.isPutOrDelActionAvailable=!0},t.prototype.hideAll=function(){this.eyeCloseButton.active=!0,this.gridBoard.active=!1,this.eyeOpenButton.active=!1,this.picScrollView.active=!1,this.utilsBoard.active=!1,this.menuBoard.active=!1,this.creationBoard.active=!1,this.portBoard.active=!1,this.numScrollView.active=!1,this.choiceBoard.active=!1,this.jsonBoard.active=!1},t.prototype.onNumButtonClicked=function(){this.choiceBoard.active=!1,this.numScrollView.active?this.numScrollView.active=!1:(this.numScrollView.active=!0,this.updatePicNum()),this.updateLocalStorage()},t.prototype.onShowJsonButtonClicked=function(){if(this.portBoard.active=!1,this.creationBoard.active=!1,this.choiceBoard.active=!1,this.jsonBoard.active)this.jsonBoard.active=!1,this.gridBoardComp.isPutOrDelActionAvailable=!0;else{this.jsonBoard.active=!0;var e=this.getLevelData();this.jsonBoardLabel.getComponent(cc.Label).string=JSON.stringify(e,null,2),this.gridBoardComp.isPutOrDelActionAvailable=!1}},t.prototype.updatePicNum=function(){for(var e={},t=0,i=0;i<this.gridBoardCover.children.length;i++){var o=this.gridBoardCover.children[i];null!=e[o.name]?e[o.name]+=1:e[o.name]=1,t+=1}var n="";n+="\u603b: "+t+"\u4e2a  ",Object.keys(e).forEach(function(t){n+=t+": "+e[t]+"\u4e2a  "}),this.numScrollView.children[0].children[0].getComponent(cc.Label).string=n},s([a(cc.Node)],t.prototype,"gridBoard",void 0),s([a(cc.Node)],t.prototype,"gridBoardCover",void 0),s([a(cc.Node)],t.prototype,"indicatorCover",void 0),s([a(cc.Node)],t.prototype,"picScrollView",void 0),s([a(cc.Node)],t.prototype,"picScrollViewContent",void 0),s([a(cc.Node)],t.prototype,"hGridItemNumEditBox",void 0),s([a(cc.Node)],t.prototype,"vGridItemNumEditBox",void 0),s([a(cc.Node)],t.prototype,"gridItemWidthEditBox",void 0),s([a(cc.Node)],t.prototype,"gridItemHeightEditBox",void 0),s([a(cc.Node)],t.prototype,"offsetXEditBox",void 0),s([a(cc.Node)],t.prototype,"offsetYEditBox",void 0),s([a(cc.Node)],t.prototype,"noMovingToggle",void 0),s([a(cc.Node)],t.prototype,"noScalingToggle",void 0),s([a(cc.Node)],t.prototype,"putToggle",void 0),s([a(cc.Node)],t.prototype,"delToggle",void 0),s([a(cc.Node)],t.prototype,"messageBoard",void 0),s([a(cc.Node)],t.prototype,"choiceBoard",void 0),s([a(cc.Node)],t.prototype,"creationBoard",void 0),s([a(cc.Node)],t.prototype,"portBoard",void 0),s([a(cc.Node)],t.prototype,"eyeOpenButton",void 0),s([a(cc.Node)],t.prototype,"eyeCloseButton",void 0),s([a(cc.Node)],t.prototype,"menuBoard",void 0),s([a(cc.Node)],t.prototype,"utilsBoard",void 0),s([a(cc.Node)],t.prototype,"numScrollView",void 0),s([a(cc.Node)],t.prototype,"jsonBoard",void 0),s([a(cc.Node)],t.prototype,"jsonBoardLabel",void 0),s([r],t)}(cc.Component);i.default=c,cc._RF.pop()},{}],PicScrollView:[function(e,t,i){"use strict";cc._RF.push(t,"83244qZDctHTaZRpSDS5C3r","PicScrollView");var o,n=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__decorate||function(e,t,i,o){var n,s=arguments.length,d=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(d=(s<3?n(d):s>3?n(t,i,d):n(t,i))||d);return s>3&&d&&Object.defineProperty(t,i,d),d};Object.defineProperty(i,"__esModule",{value:!0});var d=cc._decorator,r=d.ccclass,a=d.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.picScrollViewContent=null,t.picItemPrefab=null,t.noPicLabel=null,t.levelEditorComp=null,t.selectedPicItem=null,t}return n(t,e),t.prototype.start=function(){this.addEvents(),this.initComponents(),this.initPicScrollView()},t.prototype.addEvents=function(){this.picScrollViewContent.on(cc.Node.EventType.MOUSE_DOWN,this.onMouseDown,this),this.picScrollViewContent.on(cc.Node.EventType.MOUSE_MOVE,this.onMouseMove,this),this.picScrollViewContent.on(cc.Node.EventType.MOUSE_LEAVE,this.onMouseLeave,this)},t.prototype.initComponents=function(){this.levelEditorComp=cc.find("Canvas").getComponent("LevelEditor")},t.prototype.initPicScrollView=function(){var e=this;cc.resources.loadDir("pic",cc.SpriteFrame,function(t,i){if(0!=i.length){e.noPicLabel.active=!1;for(var o=0;o<i.length;o++){var n=e.spawnPicItem(i[o].name,i[o]);e.picScrollViewContent.addChild(n)}e.picScrollViewContent.children[0].setScale(new cc.Vec2(1.3,1.3)),e.selectedPicItem=e.picScrollViewContent.children[0],e.levelEditorComp.editorData&&e.restoreSelectedPicItem()}})},t.prototype.restoreSelectedPicItem=function(){for(var e=0;e<this.picScrollViewContent.children.length;e++){var t=this.picScrollViewContent.children[e];if(t.name==this.levelEditorComp.editorData.picItemName){this.selectedPicItem=t,this.selectedPicItem.setScale(new cc.Vec2(1.3,1.3));break}}},t.prototype.spawnPicItem=function(e,t){var i=cc.instantiate(this.picItemPrefab);return i.width=40,i.height=40,i.name=e,i.getComponent(cc.Sprite).spriteFrame=t,i},t.prototype.onMouseDown=function(e){for(var t=this.picScrollViewContent.convertToNodeSpaceAR(e.getLocation()),i=0;i<this.picScrollViewContent.children.length;i++){var o=this.picScrollViewContent.children[i];if(o.getBoundingBox().contains(t)){o==this.selectedPicItem?(o.setScale(new cc.Vec2(1,1)),this.selectedPicItem=null):(this.selectedPicItem&&this.selectedPicItem.setScale(new cc.Vec2(1,1)),o.setScale(new cc.Vec2(1.3,1.3)),this.selectedPicItem=o),this.levelEditorComp.updateLocalStorage();break}}},t.prototype.onMouseMove=function(e){for(var t=this.picScrollViewContent.convertToNodeSpaceAR(e.getLocation()),i=0;i<this.picScrollViewContent.children.length;i++)(o=this.picScrollViewContent.children[i])!=this.selectedPicItem&&o.setScale(new cc.Vec2(1,1));for(i=0;i<this.picScrollViewContent.children.length;i++){var o;if((o=this.picScrollViewContent.children[i]).getBoundingBox().contains(t)){o!=this.selectedPicItem&&o.setScale(new cc.Vec2(1.2,1.2));break}}},t.prototype.onMouseLeave=function(){for(var e=0;e<this.picScrollViewContent.children.length;e++){var t=this.picScrollViewContent.children[e];t!=this.selectedPicItem&&t.setScale(new cc.Vec2(1,1))}},s([a(cc.Node)],t.prototype,"picScrollViewContent",void 0),s([a(cc.Prefab)],t.prototype,"picItemPrefab",void 0),s([a(cc.Node)],t.prototype,"noPicLabel",void 0),s([r],t)}(cc.Component);i.default=c,cc._RF.pop()},{}],UserGuide:[function(e,t,i){"use strict";cc._RF.push(t,"ed763V76sRKJLCBmp3S8Wp4","UserGuide");var o,n=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__decorate||function(e,t,i,o){var n,s=arguments.length,d=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,t,i,o);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(d=(s<3?n(d):s>3?n(t,i,d):n(t,i))||d);return s>3&&d&&Object.defineProperty(t,i,d),d};Object.defineProperty(i,"__esModule",{value:!0});var d=cc._decorator.ccclass,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentStepTemp=1,t.textPosTemp="follow",t.keyDownInterval=1.5,t.isTyping=!1,t.typingInterval=.05,t.guideSignRotation=90,t.scheduleCount=0,t.guideTextTemp="",t.isGuideSignTweenEnabled=!1,t.guideSignTween=null,t.guideSignTweenType="",t.isGudieSignFlying=!1,t.guideSignFlyingTween=null,t.flyingTweenDuration=.3,t.isFlyingFinised=!0,t.guideSignSlideTweenData={slideDistance:null,slideTime:.5},t.isGuidedByGroup=!1,t.stepIndexInArray=0,t.currentStepArrayTemp=[],t.setMaskAndGuideSpritePosAndSizeScheduleCallBack=null,t.guideData={nodesAndTexts:[{nodeUUID:"",path:"",key:"",guideText:"\u6b22\u8fce\u4f7f\u7528\u8fd9\u6b3e\u901a\u7528\u5173\u5361\u7f16\u8f91\u5668\uff0c\u6211\u4eec\u6765\u770b\u770b\u600e\u4e48\u4f7f\u7528\u5b83~",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"74KBoTNTlB3oFuDvmF+uk8",path:"Canvas/Grid Board",key:"",guideText:"\u5f53\u4e2d\u7684\u7f51\u683c\u5c31\u662f\u653e\u7f6e\u56fe\u7247\u7684\u5730\u65b9\uff0c\u6211\u4eec\u53ef\u4ee5\u79fb\u52a8\u5b83\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6eda\u8f6e\u8ba9\u5b83\u53d8\u5927\u53d8\u5c0f",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"967pMtLQZES5zMBqI9DEFC",path:"Canvas/Pic ScrollView",key:"",guideText:"\u53f3\u8fb9\u7684\u6eda\u52a8\u89c6\u56fe\u4f1a\u663e\u793a\u4f60\u8981\u4f7f\u7528\u7684\u6240\u6709\u56fe\u7247\uff0c\u70b9\u51fb\u67d0\u5f20\u56fe\u7247\u5c31\u53ef\u4ee5\u9009\u4e2d\u5b83",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"6e6XGFCnRJSppm6JSCdy/6",path:"Canvas/Utils Board/Reset Pos Button",key:"",guideText:"\u79fb\u52a8\u7f51\u683c\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u6309\u94ae\u5c06\u7f51\u683c\u8bbe\u7f6e\u5230\u539f\u59cb\u4f4d\u7f6e",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"2fTBepbNxI7oatZ1INcPe5",path:"Canvas/Utils Board/Reset Scale Button",key:"",guideText:"\u7f29\u653e\u7f51\u683c\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u6309\u94ae\u5c06\u7f51\u683c\u8bbe\u7f6e\u5230\u539f\u59cb\u5927\u5c0f",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"6dcg84zu9IIrPu5ImVKzgM",path:"Canvas/Utils Board/Clear All Button",key:"",guideText:"\u5982\u679c\u8981\u6e05\u9664\u6240\u6709\u56fe\u7247\uff0c\u53ef\u4ee5\u70b9\u51fb\u8fd9\u4e2a\u6309\u94ae\uff0c\u70b9\u51fb\u540e\u7a0b\u5e8f\u4f1a\u8ddf\u4f60\u8fdb\u884c\u786e\u8ba4",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"3bs0z2qcBL/owJZoEwEJW4",path:"Canvas/Utils Board/Put Or Del ToggleContainer",key:"",guideText:"\u5728\u8fd9\u91cc\u53ef\u4ee5\u9009\u62e9\u5f53\u524d\u64cd\u4f5c: \u653e\u7f6e\u6216\u8005\u662f\u5220\u9664\u4e00\u5f20\u56fe\u7247",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"adtBNjHlVEf6GuIALuMb18",path:"Canvas/Utils Board/Offset Layout",key:"",guideText:"\u4e00\u4e9b\u4e09\u6d88\u6e38\u620f\u53ef\u80fd\u9700\u8981\u906e\u6321\u6548\u679c\uff0c\u8fd9\u91cc\u7684\u504f\u79fb\u529f\u80fd\u53ef\u4ee5\u5e2e\u4f60\u5b9e\u73b0\u3002\u4f60\u53ef\u4ee5\u76f4\u63a5\u7f16\u8f91\u6570\u5b57\uff0c\u6216\u8005\u53ef\u4ee5\u901a\u8fc7WASD\u952e\u6539\u53d8\u504f\u79fb\u91cf",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"dcPGmv0thPb7DlTU0lXiHj",path:"Canvas/Utils Board/CheckBox Layout",key:"",guideText:"\u5982\u679c\u8981\u7981\u6b62\u79fb\u52a8\u6216\u7f29\u653e\u7f51\u683c\uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u6253\u4e0a\u52fe",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"47t5QZnKhLOoVeb3RD2Y4x",path:"Canvas/Menu Board/Menu Layout/Port Button",key:"",guideText:"\u8be5\u6309\u94ae\u7528\u6765\u663e\u793a\u5bfc\u5165\u5bfc\u51fa\u9762\u677f",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"efnERPiMVGCYvRZcpyCiNK",path:"Canvas/Menu Board/Menu Layout/Grid Creation Button",key:"",guideText:"\u8be5\u6309\u94ae\u7528\u6765\u663e\u793a\u65b0\u5efa\u7f51\u683c\u9762\u677f",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"8d9KeJWG5DWoNsQMhbKShs",path:"Canvas/Menu Board/Menu Layout/Num Button",key:"",guideText:"\u8be5\u6309\u94ae\u7528\u6765\u663e\u793a\u56fe\u7247\u6570\u91cf\u7edf\u8ba1\u9762\u677f",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"e6wBBSFVRG9I6X5uCivpMg",path:"Canvas/Menu Board/Menu Layout/Show Json Button",key:"",guideText:"\u70b9\u51fb\u8fd9\u4e2a\u6309\u94ae\u5c31\u53ef\u4ee5\u770b\u5230\u5f53\u524d\u7684JSON\u6570\u636e\u60c5\u51b5",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"ad87tu5bdCMJwKSg0p/l9C",path:"Canvas/Eye Open Button",key:"",guideText:"\u8fd9\u4e2a\u773c\u775b\u6309\u94ae\u662f\u7528\u6765\u9884\u89c8\u7684\uff0c\u5b83\u4f1a\u628a\u56fe\u7247\u4e4b\u5916\u7684\u6240\u6709\u8282\u70b9\u5168\u90e8\u9690\u85cf",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"",path:"",key:"",guideText:"\u5982\u679c\u6709\u4efb\u4f55\u4f7f\u7528\u4e0a\u7684\u95ee\u9898\u6216\u53d1\u73b0\u4e86\u4ec0\u4e48bug\uff0c\u6b22\u8fce\u8054\u7cfb\u4f5c\u8005\u6211\u54c8\uff0c\u8054\u7cfb\u65b9\u5f0f\u53ef\u4ee5\u5728\u5546\u57ce\u9875\u9762\u4e0a\u627e\u5230",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""},{nodeUUID:"",path:"",key:"",guideText:"\u90a3\u73b0\u5728\u5c31\u8ba9\u6211\u4eec\u5f00\u59cb\u4f7f\u7528\u8fd9\u6b3e\u901a\u7528\u5173\u5361\u7f16\u8f91\u5668\u5427~",guideEnText:"",guideType:"touch",isDynamic:!1,isAliased:!1,alias:""}],guideSignType:"frame"},t.guideTextLang="zh",t.canvasUITransform={width:0,height:0},t.maskNode=null,t.blockBgNode=null,t.guideSignSpriteNode=null,t.guideSignPosTemp=null,t.guideTextBgSpriteNode=null,t.guideTextLabelNode=null,t}return n(t,e),t.prototype.onLoad=function(){this.canvasUITransform.width=this.node.width,this.canvasUITransform.height=this.node.height,this.createNodes()},t.prototype.start=function(){},t.prototype.createNodes=function(){this.createMaskNode(),this.createBlockBgNode(),this.createGuideSignSpriteNode(),this.createGuideTextBgSpriteNode(),this.createGuideTextLabelNode()},t.prototype.createMaskNode=function(){this.maskNode=new cc.Node("Mask Node"),this.maskNode.active=!1,this.maskNode.addComponent(cc.Mask),this.node.addChild(this.maskNode)},t.prototype.createBlockBgNode=function(){var e=this;this.blockBgNode=new cc.Node("Block Bg Node"),this.blockBgNode.addComponent(cc.BlockInputEvents);var t=this.blockBgNode.addComponent(cc.Sprite);this.blockBgNode.color=new cc.Color(0,0,0),this.blockBgNode.opacity=100;var i=this;cc.resources.load("user-guide/default_btn_normal",cc.SpriteFrame,function(o,n){t.spriteFrame=n,i.blockBgNode.width=10*e.canvasUITransform.width,i.blockBgNode.height=10*e.canvasUITransform.height}),this.maskNode.addChild(this.blockBgNode)},t.prototype.createGuideSignSpriteNode=function(){var e=this;this.guideSignSpriteNode=new cc.Node("Guide Sign Sprite Node"),this.guideSignSpriteNode.active=!1;var t=this.guideSignSpriteNode.addComponent(cc.Sprite);"frame"==this.guideData.guideSignType&&(t.type=cc.Sprite.Type.SLICED),cc.resources.load("user-guide/guideSign",cc.SpriteFrame,function(i,o){t.spriteFrame=o,e.adjustGuideSignSpriteNode(1)}),this.node.addChild(this.guideSignSpriteNode)},t.prototype.createGuideTextBgSpriteNode=function(){this.guideTextBgSpriteNode=new cc.Node("Text Bg Sprite Node"),this.guideTextBgSpriteNode.active=!1;var e=this,t=this.guideTextBgSpriteNode.addComponent(cc.Sprite);t.type=cc.Sprite.Type.SLICED,cc.resources.load("user-guide/textBg",cc.SpriteFrame,function(i,o){t.spriteFrame=o,"bottom"==e.textPosTemp?e.setGuideTextBgSpriteSizeByCanvasSize():e.setGuideTextBgSpriteSizeByTextLength()}),this.node.addChild(this.guideTextBgSpriteNode)},t.prototype.createGuideTextLabelNode=function(){this.guideTextLabelNode=new cc.Node("Guide Text Label Node"),this.guideTextLabelNode.width=100,this.guideTextLabelNode.height=40;var e=this.guideTextLabelNode.addComponent(cc.Label);e.horizontalAlign=cc.Label.HorizontalAlign.LEFT,e.verticalAlign=cc.Label.VerticalAlign.TOP,e.overflow=cc.Label.Overflow.SHRINK,this.guideTextLabelNode.color=new cc.Color(0,0,0),e.fontSize=28,this.guideTextBgSpriteNode.addChild(this.guideTextLabelNode),this.guideTextLabelNode.setPosition(0,-5,0)},t.prototype.hideGuide=function(){this.maskNode.active=!1,this.guideSignSpriteNode.active=!1,this.guideTextBgSpriteNode.active=!1},t.prototype.slideGuideSign=function(e,t){void 0===t&&(t=2),"hand"!=this.guideData.guideSignType&&"arrow"!=this.guideData.guideSignType||(this.isGuideSignTweenEnabled=!0,this.guideSignTweenType="slide",this.guideSignSlideTweenData={slideDistance:e,slideTime:t})},t.prototype.setGuideSignFly=function(e){void 0===e&&(e=!1),this.isGudieSignFlying=e},t.prototype.setGuideSignFlyingDuration=function(e){void 0===e&&(e=.3),this.flyingTweenDuration=e},t.prototype.makeGuideSignMoveUpAndDown=function(){"hand"!=this.guideData.guideSignType&&"arrow"!=this.guideData.guideSignType||(this.isGuideSignTweenEnabled=!0,this.guideSignTweenType="updown")},t.prototype.setGuideSignRotation=function(e){void 0===e&&(e=90),"hand"!=this.guideData.guideSignType&&"arrow"!=this.guideData.guideSignType||(this.guideSignRotation=e)},t.prototype.setGuideSignPos=function(e){this.guideSignPosTemp=e},t.prototype.replaceGuideSignNodeWithCustomNode=function(e){var t=cc.find(e);return t?t.parent!=this.node?(console.log("\u8bf7\u786e\u4fdd\u8be5\u81ea\u5b9a\u4e49\u8282\u70b9\u7684\u7236\u8282\u70b9\u4e3a\u753b\u5e03\u3002"),void console.log("Please make sure the parent of this custom node is the canvas node.")):(this.guideSignSpriteNode=t,this.guideData.guideSignType="hand",void this.setGuideSignRotation(0)):(console.log("\u6ca1\u6709\u627e\u5230\u8be5\u81ea\u5b9a\u4e49\u8282\u70b9\uff0c\u8bf7\u786e\u4fdd\u8def\u5f84\u6b63\u786e\u3002"),void console.log("Couldn't find the custom node. Please make sure the path is correct."))},t.prototype.startGuideSignTween=function(){this.guideSignTween&&this.guideSignTween.stop(),"slide"==this.guideSignTweenType?this.initGuideSignSlideTween():"updown"==this.guideSignTweenType&&this.initGuideSignUpDownTween(),this.guideSignTween.start()},t.prototype.initGuideSignSlideTween=function(){var e=this.guideSignSlideTweenData.slideTime,t=this.guideSignSlideTweenData.slideDistance;this.guideSignTween=cc.tween(this.guideSignSpriteNode).by(e,{position:t}).by(e/5,{position:new cc.Vec3(-t.x,-t.y,-t.z)}).union().repeatForever()},t.prototype.initGuideSignUpDownTween=function(){this.guideSignTween=cc.tween(this.guideSignSpriteNode).by(.5,{position:new cc.Vec3(0,-10,0)}).by(.5,{position:new cc.Vec3(0,10,0)}).union().repeatForever()},t.prototype.stopGuideSignTween=function(){this.guideSignTween&&(this.isGuideSignTweenEnabled=!1,this.guideSignTween.stop(),this.guideSignTween=null,this.guideSignTweenType="",this.guideSignSlideTweenData={slideDistance:null,slideTime:.5})},t.prototype.setGuideSignScale=function(e,t){this.guideSignSpriteNode.setScale(e,t,0)},t.prototype.setGuideTextColor=function(e){this.guideTextLabelNode.color=e},t.prototype.setGuideTextFontSize=function(e){this.guideTextLabelNode.getComponent(cc.Label).fontSize=e},t.prototype.setGuideTextSystemFont=function(e){this.guideTextLabelNode.getComponent(cc.Label).useSystemFont=!0,this.guideTextLabelNode.getComponent(cc.Label).fontFamily=e},t.prototype.setGuideTextCustomFont=function(e){var t=this;this.guideTextLabelNode.getComponent(cc.Label).useSystemFont=!1,cc.resources.load(e,cc.Font,function(e,i){t.guideTextLabelNode.getComponent(cc.Label).font=i})},t.prototype.setGuideTextLineHeight=function(e){this.guideTextLabelNode.getComponent(cc.Label).lineHeight=e},t.prototype.setGuideTextPos=function(e){void 0===e&&(e="follow"),this.textPosTemp=e},t.prototype.setGuideTextLang=function(e){void 0===e&&(e="zh"),this.guideTextLang=e},t.prototype.setGuideTextBackgroundScale=function(e,t){this.guideTextBgSpriteNode.setScale(e,t,0),this.guideTextLabelNode.setScale(1/e,1/t,0),this.guideTextLabelNode.width=this.guideTextBgSpriteNode.width*e/1.1,this.guideTextLabelNode.width=this.guideTextBgSpriteNode.height*t/1.1},t.prototype.setMaskColor=function(e){this.blockBgNode.color=e,this.blockBgNode.opacity=e.a},t.prototype.setMaskShape=function(e,t){void 0===t&&(t=null),"rect"==e?this.maskNode.getComponent(cc.Mask).type=cc.Mask.Type.RECT:"ellipse"==e?this.maskNode.getComponent(cc.Mask).type=cc.Mask.Type.ELLIPSE:"sprite stencil"==e&&t&&(this.maskNode.getComponent(cc.Mask).type=cc.Mask.Type.IMAGE_STENCIL,this.maskNode.getComponent(cc.Mask).spriteFrame=t)},t.prototype.setKeyDownInterval=function(e){this.keyDownInterval=e},t.prototype.setTypingEnabled=function(e){this.isTyping=e},t.prototype.setTypingInterval=function(e){this.typingInterval=e},t.prototype.showGuideByGroup=function(e,t){void 0===t&&(t=null),e.length&&(this.isGuidedByGroup=!0,this.currentStepArrayTemp=e,this.showGuide(e[this.stepIndexInArray],!0,t))},t.prototype.showGuide=function(e,t,i){if(void 0===t&&(t=!1),void 0===i&&(i=null),!e)return console.log("\u8bf7\u8bbe\u7f6e\u53c2\u6570step\u7684\u503c\u3002"),void console.log("Please set parameter step's value.");if("string"==typeof e){var o=e;if(0==(e=this.changeAliasToIndex(e)))return console.log("step\u540d\u79f0"+o+"\u4e0d\u5b58\u5728\u3002"),void console.log("The step alias "+o+" does not exist.")}if(e>this.guideData.nodesAndTexts.length)return this.isGuideSignTweenEnabled&&this.stopGuideSignTween(),void(t&&i&&i());if(this.guideData.nodesAndTexts[e-1].path||this.guideData.nodesAndTexts[e-1].key)if(this.currentStepTemp=e,"touch"==this.guideData.nodesAndTexts[e-1].guideType){var n=this.guideData.nodesAndTexts[e-1].path;if(!n)return console.error("\u672a\u627e\u5230uuid\u4e3a"+this.guideData.nodesAndTexts[e-1].nodeUUID+"\u7684\u8282\u70b9"),void console.error("Can't find the node whose uuid is "+this.guideData.nodesAndTexts[e-1].nodeUUID);var s=cc.find(n);this.showNodeAndTextGuide(s,e,t,i)}else{var d=this.guideData.nodesAndTexts[e-1].key.split("+");this.showKeyAndTextGuide(d,e,t,i)}else this.showOnlyTextGuide(e,t,i)},t.prototype.changeAliasToIndex=function(e){for(var t=0;t<this.guideData.nodesAndTexts.length;t++)if(this.guideData.nodesAndTexts[t].alias==e)return t+1;return 0},t.prototype.goToNextGuide=function(e,t,i){void 0===i&&(i=null),this.isGuidedByGroup?(this.stepIndexInArray+=1,this.stepIndexInArray>=this.currentStepArrayTemp.length?(this.stepIndexInArray=0,this.isGuidedByGroup=!1,this.currentStepArrayTemp=[],this.isGuideSignTweenEnabled&&this.stopGuideSignTween(),i&&i()):this.showGuide(this.currentStepArrayTemp[this.stepIndexInArray],t,i)):this.showGuide(e+=1,t,i)},t.prototype.showOnlyTextGuide=function(e,t,i){var o=this;void 0===i&&(i=null),this.maskNode.active=!0,this.guideTextBgSpriteNode.active=!0;var n=this,s=function(){o.hideGuide(),t?n.goToNextGuide(e,t,i):i&&i(),o.blockBgNode.off(cc.Node.EventType.TOUCH_START,s,n)};this.blockBgNode.on(cc.Node.EventType.TOUCH_START,s,n),this.maskNode.setSiblingIndex(Number.MAX_SAFE_INTEGER),this.maskNode.getComponent(cc.Mask).inverted=!0,this.maskNode.width=0,this.maskNode.height=0,this.adjustGuideTextBgSpriteNode(),this.adjustGuideTextLabelNode(e)},t.prototype.showNodeAndTextGuide=function(e,t,i,o){var n=this;void 0===o&&(o=null),this.maskNode.active=!0,this.guideSignSpriteNode.active=!0,this.guideTextBgSpriteNode.active=!0,this.guideSignFlyingTween=null;var s=this,d=function(){s.hideGuide(),s.unschedule(n.setMaskAndGuideSpritePosAndSizeScheduleCallBack),i?s.goToNextGuide(t,i,o):o&&o(),e.off(cc.Node.EventType.TOUCH_START,d,s)};e.on(cc.Node.EventType.TOUCH_START,d,s),this.maskNode.setPosition(new cc.Vec3(0,0,0)),this.maskNode.angle=0,this.maskNode.setSiblingIndex(Number.MAX_SAFE_INTEGER),this.maskNode.getComponent(cc.Mask).inverted=!0,this.setMaskAndGuideSpritePosAndSizeScheduleCallBack=function(){if(n.maskNode.width=e.width*e.scaleX*1.1,n.maskNode.height=e.height*e.scaleY*1.1,e.parent==n.node)n.maskNode.setPosition(e.position),n.adjustPosAccordingToAnchorPoint(n.maskNode,e);else{n.maskNode.setPosition(new cc.Vec3(0,0,0)),n.maskNode.angle=0;for(var i=n.getAllParentPosIncludingSelf(e),o=i.length-1;o>=0;o--)n.maskNode.setPosition(new cc.Vec3(n.maskNode.position).add(i[o]));n.maskNode.angle=e.angle,n.adjustPosAccordingToAnchorPoint(n.maskNode,e)}n.blockBgNode.width=10*n.canvasUITransform.width,n.blockBgNode.height=10*n.canvasUITransform.height,n.adjustGuideTextBgSpriteNode(),n.adjustGuideSignSpriteNode(t)},this.unschedule(this.setMaskAndGuideSpritePosAndSizeScheduleCallBack),this.setMaskAndGuideSpritePosAndSizeScheduleCallBack();var r=function(){n.schedule(n.setMaskAndGuideSpritePosAndSizeScheduleCallBack,.01,cc.macro.REPEAT_FOREVER),e.off(cc.Node.EventType.POSITION_CHANGED,r,n),e.off(cc.Node.EventType.SIZE_CHANGED,r,n),e.off(cc.Node.EventType.ANCHOR_CHANGED,r,n),n.offTargetNodeParentTransformChanged(e,r)};this.scheduleOnce(function(){e.on(cc.Node.EventType.POSITION_CHANGED,r,n),e.on(cc.Node.EventType.SIZE_CHANGED,r,n),e.on(cc.Node.EventType.ANCHOR_CHANGED,r,n),n.onTargetNodeParentTransformChanged(e,r)},.01),this.adjustGuideTextLabelNode(t)},t.prototype.adjustPosAccordingToAnchorPoint=function(e,t){var i=e.getAnchorPoint(),o=t.getAnchorPoint();if(i.x!=o.x||i.y!=o.y){var n=i.x-o.x,s=i.y-o.y;e.position=e.position.add(new cc.Vec3(n*t.width,s*t.height,0))}},t.prototype.onTargetNodeParentTransformChanged=function(e,t){for(var i=null;;)if(!i&&e.parent)(i=e.parent).on(cc.Node.EventType.POSITION_CHANGED,t,this),i.on(cc.Node.EventType.SIZE_CHANGED,t,this),i.on(cc.Node.EventType.ANCHOR_CHANGED,t,this);else{if(!i||!i.parent)break;(i=i.parent).on(cc.Node.EventType.POSITION_CHANGED,t,this),i.on(cc.Node.EventType.SIZE_CHANGED,t,this),i.on(cc.Node.EventType.ANCHOR_CHANGED,t,this)}},t.prototype.offTargetNodeParentTransformChanged=function(e,t){for(var i=null;;)if(!i&&e.parent)(i=e.parent).off(cc.Node.EventType.POSITION_CHANGED,t,this),i.off(cc.Node.EventType.SIZE_CHANGED,t,this),i.off(cc.Node.EventType.ANCHOR_CHANGED,t,this);else{if(!i||!i.parent)break;(i=i.parent).off(cc.Node.EventType.POSITION_CHANGED,t,this),i.off(cc.Node.EventType.SIZE_CHANGED,t,this),i.off(cc.Node.EventType.ANCHOR_CHANGED,t,this)}},t.prototype.showKeyAndTextGuide=function(e,t,i,o){var n=this;void 0===o&&(o=null),this.maskNode.active=!0,this.guideTextBgSpriteNode.active=!0;var s=0,d=this,r=[],a=function(c){var h=(new Date).getTime();(h-s)/1e3>n.keyDownInterval&&(s=h,r=[]),r.push(c.keyCode.toString()),JSON.stringify(e)==JSON.stringify(r)&&(d.hideGuide(),i?d.goToNextGuide(t,i,o):o&&o(),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,a,d))};cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,a,d),this.maskNode.setPosition(new cc.Vec3(0,0,0)),this.maskNode.setSiblingIndex(Number.MAX_SAFE_INTEGER),this.maskNode.getComponent(cc.Mask).inverted=!0,this.maskNode.width=0,this.maskNode.height=0,this.adjustGuideTextBgSpriteNode(),this.adjustGuideTextLabelNode(t)},t.prototype.adjustGuideSignSpriteNode=function(e){var t=this;if(this.guideSignSpriteNode.setSiblingIndex(Number.MAX_SAFE_INTEGER),"frame"==this.guideData.guideSignType){var i=function(){t.guideSignSpriteNode.angle=t.maskNode.angle,t.guideSignPosTemp?t.guideSignSpriteNode.setPosition(t.guideSignPosTemp):t.guideSignSpriteNode.setPosition(t.maskNode.position)};this.isGudieSignFlying&&1!=e?this.guideSignFlyingTween?this.isFlyingFinised&&i():(this.isFlyingFinised=!1,this.guideSignFlyingTween=cc.tween(this.guideSignSpriteNode).to(this.flyingTweenDuration,{position:this.maskNode.position,rotation:this.guideSignSpriteNode.angle}).call(function(){i(),t.isFlyingFinised=!0,t.isGuideSignTweenEnabled&&t.startGuideSignTween()}),this.guideSignFlyingTween.start()):i(),this.guideSignSpriteNode.width=1.1*this.maskNode.width,this.guideSignSpriteNode.height=1.1*this.maskNode.height}else if("hand"==this.guideData.guideSignType||"arrow"==this.guideData.guideSignType){if(this.maskNode.width&&this.maskNode.height||(this.guideSignSpriteNode.active=!1),this.maskNode.position.y>=0){var o=function(){t.guideSignSpriteNode.angle=t.guideSignRotation,t.guideSignPosTemp?t.guideSignSpriteNode.setPosition(t.guideSignPosTemp):t.guideSignSpriteNode.setPosition(new cc.Vec3(t.maskNode.position).subtract(new cc.Vec3(0,1.01*t.maskNode.height,0)))};this.isGudieSignFlying&&1!=e?this.guideSignFlyingTween?this.isFlyingFinised&&o():(this.isFlyingFinised=!1,this.guideSignFlyingTween=cc.tween(this.guideSignSpriteNode).to(this.flyingTweenDuration,{position:new cc.Vec3(this.maskNode.position).subtract(new cc.Vec3(0,1.01*this.maskNode.height,0)),rotation:this.guideSignSpriteNode.angle}).call(function(){o(),t.isFlyingFinised=!0,t.isGuideSignTweenEnabled&&t.startGuideSignTween()}),this.guideSignFlyingTween.start()):o()}else if(this.maskNode.position.y<0){var n=function(){t.guideSignSpriteNode.angle=-t.guideSignRotation,t.guideSignPosTemp?t.guideSignSpriteNode.setPosition(t.guideSignPosTemp):t.guideSignSpriteNode.setPosition(new cc.Vec3(t.maskNode.position).subtract(new cc.Vec3(0,1.01*-t.maskNode.height,0)))};this.isGudieSignFlying&&1!=e?this.guideSignFlyingTween?this.isFlyingFinised&&n():(this.isFlyingFinised=!1,this.guideSignFlyingTween=cc.tween(this.guideSignSpriteNode).to(this.flyingTweenDuration,{position:new cc.Vec3(this.maskNode.position).subtract(new cc.Vec3(0,1.01*-this.maskNode.height,0)),rotation:this.guideSignSpriteNode.angle}).call(function(){n(),t.isFlyingFinised=!0,t.isGuideSignTweenEnabled&&t.startGuideSignTween()}),this.guideSignFlyingTween.start()):n()}this.isGuideSignTweenEnabled&&this.isFlyingFinised&&this.startGuideSignTween()}},t.prototype.adjustGuideTextBgSpriteNode=function(){if(this.guideTextBgSpriteNode.setSiblingIndex(Number.MAX_SAFE_INTEGER),"center"==this.textPosTemp)this.setGuideTextBgSpriteSizeByTextLength(),this.guideTextBgSpriteNode.setPosition(0,0,0);else if("bottom"==this.textPosTemp){this.setGuideTextBgSpriteSizeByCanvasSize();var e=this.canvasUITransform.height/2-this.guideTextBgSpriteNode.height/2;this.guideTextBgSpriteNode.setPosition(0,-e,0)}else"follow"==this.textPosTemp?(this.setGuideTextBgSpriteSizeByTextLength(),this.maskNode.position.x>=0&&this.maskNode.position.y>=0?this.guideTextBgSpriteNode.setPosition(new cc.Vec3(this.maskNode.position).subtract(new cc.Vec3(1.1*this.maskNode.width,1.1*this.maskNode.height,0))):this.maskNode.position.x>=0&&this.maskNode.position.y<=0?this.guideTextBgSpriteNode.setPosition(new cc.Vec3(this.maskNode.position).subtract(new cc.Vec3(1.1*this.maskNode.width,1.1*-this.maskNode.height,0))):this.maskNode.position.x<=0&&this.maskNode.position.y>=0?this.guideTextBgSpriteNode.setPosition(new cc.Vec3(this.maskNode.position).subtract(new cc.Vec3(1.1*-this.maskNode.width,1.1*this.maskNode.height,0))):this.maskNode.position.x<=0&&this.maskNode.position.y<=0&&this.guideTextBgSpriteNode.setPosition(new cc.Vec3(this.maskNode.position).subtract(new cc.Vec3(1.1*-this.maskNode.width,1.1*-this.maskNode.height,0)))):"object"==typeof this.textPosTemp&&(this.setGuideTextBgSpriteSizeByTextLength(),this.guideTextBgSpriteNode.setPosition(this.textPosTemp))},t.prototype.setGuideTextBgSpriteSizeByCanvasSize=function(){this.guideTextBgSpriteNode.width=this.canvasUITransform.width,this.guideTextBgSpriteNode.height=this.canvasUITransform.height/7},t.prototype.setGuideTextBgSpriteSizeByTextLength=function(){var e="",t=0,i=0;if("zh"==this.guideTextLang?(e=this.guideData.nodesAndTexts[this.currentStepTemp-1].guideText).length<=15&&e.length>0?(t=this.canvasUITransform.width/7,i=this.canvasUITransform.height/10):e.length>15&&e.length<=40?(t=this.canvasUITransform.width/5,i=this.canvasUITransform.height/8):e.length>40&&(t=this.canvasUITransform.width/3,i=this.canvasUITransform.height/6):(e=this.guideData.nodesAndTexts[this.currentStepTemp-1].guideEnText).length<=40&&e.length>0?(t=this.canvasUITransform.width/7,i=this.canvasUITransform.height/10):e.length>15&&e.length<=80?(t=this.canvasUITransform.width/5,i=this.canvasUITransform.height/8):e.length>80&&(t=this.canvasUITransform.width/3,i=this.canvasUITransform.height/6),t<i){var o=i;i=t,t=o}this.guideTextBgSpriteNode.width=t,this.guideTextBgSpriteNode.height=i},t.prototype.adjustGuideTextLabelNode=function(e){var t=this;if(this.isTyping){this.scheduleCount=0,"zh"==this.guideTextLang?this.guideTextTemp=this.guideData.nodesAndTexts[e-1].guideText:this.guideTextTemp=this.guideData.nodesAndTexts[e-1].guideEnText;var i=function(){t.guideTextTemp[t.scheduleCount]&&(t.guideTextLabelNode.getComponent(cc.Label).string+=t.guideTextTemp[t.scheduleCount]),t.scheduleCount++,t.scheduleCount>=t.guideTextTemp.length&&t.unschedule(i)};this.unschedule(i),this.guideTextLabelNode.getComponent(cc.Label).string="",this.schedule(i,this.typingInterval)}else"zh"==this.guideTextLang?this.guideTextLabelNode.getComponent(cc.Label).string=this.guideData.nodesAndTexts[e-1].guideText:this.guideTextLabelNode.getComponent(cc.Label).string=this.guideData.nodesAndTexts[e-1].guideEnText;this.guideTextLabelNode.width=this.guideTextBgSpriteNode.width*this.guideTextBgSpriteNode.scaleX/1.1,this.guideTextLabelNode.height=this.guideTextBgSpriteNode.height*this.guideTextBgSpriteNode.scaleY/1.1},t.prototype.getNodeByUuid=function(e,t){for(var i=null,o=0;o<e.children.length;o++){if(e.children[o].uuid==t){i=e.children[o];break}if(e.children[o].children.length&&(i=this.getNodeByUuid(e.children[o],t)))break}return i},t.prototype.getAllParentPosIncludingSelf=function(e){for(var t=[e.position],i=e;;){var o=i.parent;if(!o||o==this.node)break;t.push(o.position),i=o}return t},s([d],t)}(cc.Component);i.default=r,cc._RF.pop()},{}]},{},["GridBoard","LevelEditor","PicScrollView","Demo","UserGuide"]);